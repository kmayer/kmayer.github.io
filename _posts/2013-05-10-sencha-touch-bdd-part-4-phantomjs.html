---
layout: post
title: Sencha Touch BDD - Part 4 - PhantomJS
date: 2013-05-10 14:57:14.000000000 -07:00
categories:
- Work
tags:
- bdd
- jasmine
- mobile
- sencha
- Sencha Touch
- testing
---
<h1 id="senchatouchbdd">Sencha Touch BDD</h1>
<h2 id="tldr">tl;dr</h2>
<p>A multi-part series of articles on how to test Sencha Touch applications. It uses Jasmine for unit testing and Siesta for integration testing.</p>
<h2 id="part4--headlesstestingusingphantomjs">Part 4 – Headless testing using PhantomJS</h2>
<p><a title="Sencha Touch BDD – Part 3 – Testing Views and Mocking Stores" href="http://blog.bitwrangler.com/2013/05/05/sencha-touch-bdd-part-3-testing-views-and-mocking-stores/">Part 3</a> added <a href="https://github.com/pivotal/jasmine-ajax/tree/2_0">jasmine-ajax</a> so we can verify that stores and models react properly to back-end data. We also learned how to use stores to test views, without depending on a back-end server. In <a title="Sencha Touch BDD Part 2" href="http://blog.bitwrangler.com/2013/04/26/sencha-touch-bdd-part-2/">Part 2</a> I showed you how to unit test Sencha model classes in Jasmine. In <a title="Sencha Touch BDD Part 1" href="http://blog.bitwrangler.com/2013/04/17/sencha-touch-bdd-part-1/">Part 1</a> I showed you how to set up your Sencha Touch development environment to use the <a href="http://pivotal.github.com/jasmine">Jasmine</a> JavaScript test framework.</p>
<h3 id="ihearitsallaboutthecloudthesedays">I hear it’s all about the cloud these days</h3>
<p>Not only do we use Test Driven Development, we test all the time (see also <a href="https://www.google.com/search?q=tatft">TATFT</a>). In fact, continuous testing is a key component in a well-run agile practice. Pivotal developed <a href="http://github.com/pivotal-ciborg">ciborg</a> (previously known as Lobot), to automatically deploy <a href="http://jenkins-ci.org/">Jenkins</a> servers in the cloud. Jasmine has a continuous integration target in its rake tasks, <code>rake jasmine:ci</code>. If you’ve never run it before, now is a good time to try it. You’ll notice that Jasmine launches an instance of the Firefox browser, runs the test suite, then reports the results. That’s great if you’ve got (1) Firefox and (2) a machine that has a <em>display</em>! When you run your CI tests in the cloud, the virtual machines may not be configured with a virtual display. Furthermore, the process is terribly slow.</p>
<p>In this installment, we’ll see how to mix in PhantomJS so we can run our Jasmine tests without the need for a visual browser. PhantomJS is orders of magnitude faster, too.</p>
<h3 id="dotheinstalldance">Do the install dance</h3>
<ol>
<li>Add ‘jasmine-phantom’ to your <code>Gemfile</code></li>
</ol>
<pre><code class="diff">index e6b5daf..612fb25 100644
--- a/Gemfile
+++ b/Gemfile
@@ -2,3 +2,4 @@ source "https://rubygems.org"

 gem "rake"
 gem "jasmine"
+gem "jasmine-phantom"</code></pre>
<p>and modify your <code>Rakefile</code> to load the PhantomJS tasks:</p>
<pre><code class="diff">--- a/Rakefile
+++ b/Rakefile
@@ -2,6 +2,7 @@
 begin
   require 'jasmine'
   load 'jasmine/tasks/jasmine.rake'
+  load 'jasmine-phantom/tasks.rake'
 rescue LoadError
   task :jasmine do</code></pre>
<p>Finally, run <code>bundle install</code></p>
<p>Now, when you run <code>rake -T</code> from the command line, you’ll see a new target:</p>
<pre><code class="sh">$ rake -T jasmine
rake jasmine             # Run specs via server
rake jasmine:ci          # Run continuous integration tests
rake jasmine:phantom:ci  # Run jasmine specs using phantomjs and report the results</code></pre>
<h3 id="runrake">Run rake</h3>
<p>Running it will the phantom:ci target will start the Jasmine continuous integration tests in PhantomJS instead of Firefox.</p>
<pre><code class="sh">$ rake jasmine:phantom:ci 2&gt;1 /dev/null
[2013-05-06 20:28:15] INFO  WEBrick 1.3.1
[2013-05-06 20:28:15] INFO  ruby 1.9.3 (2012-11-10) [x86_64-darwin12.2.0]
[2013-05-06 20:28:15] INFO  WEBrick::HTTPServer#start: pid=17061 port=60080
Waiting for jasmine server on 60080...

8 specs | 0 failing</code></pre>
